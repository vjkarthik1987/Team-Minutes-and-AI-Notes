<% layout('layout') %>

<%
const _prev = Array.isArray(prevEvents) ? prevEvents : [];
const _next = Array.isArray(nextEvents) ? nextEvents : [];
const _err  = error || null;
%>

<h1>My Calendar</h1>

<p>
  <strong>User:</strong> <%= user.email %><br/>
  <strong>Org:</strong> <%= org.name %>
</p>

<% if (_err) { %>
  <p style="color:#b00020; margin-top:12px;">
    <strong>Error:</strong> <%= _err %>
  </p>
<% } %>

<hr style="margin:18px 0;" />

<h2>Last 30 days - including today</h2>

<% if (_prev.length === 0) { %>
  <p>No events found.</p>
<% } else { %>
  <ul>
    <% _prev.forEach(ev => { %>
      <li style="margin-bottom:12px;">
        <strong><%= ev.subject || '(no subject)' %></strong><br/>
        <span><%= ev.start?.dateTime %> → <%= ev.end?.dateTime %></span><br/>
        

        <% if (ev.location?.displayName) { %>
          <span><%= ev.location.displayName %></span><br/>
        <% } %>

        <% if (ev._hasTranscript && ev._transcripts && ev._transcripts.length) { %>
          <a
            href="/user/transcript/ensure/<%= ev._transcripts[0].meetingId %>/<%= ev._transcripts[0].id %>?subject=<%= encodeURIComponent(ev.subject || '') %>&start=<%= encodeURIComponent(ev.start?.dateTime || '') %>&end=<%= encodeURIComponent(ev.end?.dateTime || '') %>"
            target="_blank"
            rel="noopener"
          >Transcript</a>
        <% } %>            
      </li>     
    <% }) %>
  </ul>
<% } %>

<hr style="margin:18px 0;" />

<h2>Next 3 days - from tomorrow</h2>

<% if (_next.length === 0) { %>
  <p>No upcoming events found.</p>
<% } else { %>
  <ul>
    <% _next.forEach(ev => { %>
      <li style="margin-bottom:12px;">
        <strong><%= ev.subject || '(no subject)' %></strong><br/>
        <span><%= ev.start?.dateTime %> → <%= ev.end?.dateTime %></span><br/>
        <% if (ev.location?.displayName) { %>
          <span><%= ev.location.displayName %></span>
        <% } %>
      </li>
    <% }) %>
  </ul>
<% } %>

<hr style="margin:18px 0;" />
<p><a href="/user/home">← Back to home</a></p>
